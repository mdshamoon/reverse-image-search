version: "3.9"

services:
  qdrant:
    image: qdrant/qdrant:v1.11.0
    container_name: qdrant
    restart: unless-stopped
    ports:
      - "6333:6333"
    volumes:
      - qdrant_storage:/qdrant/storage

  api:
    build: .
    container_name: reverse-image-search-api
    restart: unless-stopped
    depends_on:
      - qdrant
    environment:
      - QDRANT_URL=http://qdrant:6333
      - QDRANT_COLLECTION=items
      - IMAGE_STORAGE_DIR=/app/data/images
      - IMAGE_SEARCH_API_KEY=changeme
    ports:
      - "8020:8000"
    volumes:
      - ./data/images:/app/data/images

volumes:
  qdrant_storage:
